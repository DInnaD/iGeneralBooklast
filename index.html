<!DOCTYPE html>

<head>
  <title>iGeneralBook</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css">
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
  <link rel="stylesheet" href="css/index.css" type="text/css" href="">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js"></script>
  <script src="js/index.js" type="text/javascript"></script>
  <!--script Birthday>
    $(function(){
      $('.date').each(function(){

        $(this).datepicker();
      })

    })
  </script-->
<script type="text/javascript">
	
	function validateForm() {
var isValid = true;
$('.form-field').each(function() {
if ( $(this).val() === '' )
isValid = false;
});
return isValid;
}
</script></head>
<body>

<div data-role="page" id="home">
  <header data-role="header" data-theme="b">
  <h1>iGeneral Book</h1>
  </header>
  <div data-role="navbar">
    <ul>
      <li><a href="#home" data-transition="none" data-icon="home"></a></li>
      <li><a href="#add" data-transition="none" data-icon="plus"></a></li>
    </ul>
  </div>
  <div data-role="content">
    
    <ul id="search" data-role="listview" data-filter="true" data-filter-placeholder="Search.." data-inset="true"></ul>
    <br>
    <button id="clearContacts" onclick="return confirm('Are you sure?')" data-theme="b">Clear Contacts</button>
  </div>
<footer data-role="footer" data-theme="b">
  <h4>iGeneral Book &copy; 2017</h4>
</footer>
</div>



<div data-role="page" id="add">
  <header data-role="header" data-theme="b">
  <h1>iGeneral Book</h1>
  </header>
  <div data-role="navbar">
    <ul>
      <li><a href="#home" data-transition="none" data-icon="home"></a></li>
      <li><a href="#add" data-transition="none" data-icon="plus"></a></li>
    </ul>
  </div>
  <div data-role="content">
    <h3>Add Contact</h3>
    <form id="addForm" class="signupForm" action="index_submit" method="get" accept-charset="utf-8">
      <label for="addName"></label>
      <input type="text" class="form-field" id="addName" placeholder="Enter Name"/> 

      <label for="addPhone"></label>
      <input type="text" class="form-field" data-role="phone" class="phone" id="addPhone" data-inline="true" placeholder="Enter Phone"/>
      <!--label for="addPhone"></label>
      <input type="tel" placeholder="+380-000-00-00" pattern="^\+380-\d{3}-\d{2}-\d{2}$" required="required" data-role="phone" class="phone" id="addPhone" data-inline="true" placeholder="Enter Phone"/-->

      <label for="addUrl"></label>
      <input type="text" class="form-field" id="addUrl" placeholder="Enter Url"/> 

      <label for="addInfo"></label>
      <input type="text" class="form-field" data-role="info"  id="addInfo" data-inline="true" placeholder="Enter Info"/>

      <button id="submitAdd" class="ui-btn ui-btn-b ui-corder-all">Submit</button>
    </form>
    </div>
<footer data-role="footer" data-theme="b">
  <h4>iGeneral Book &copy; 2017</h4>
</footer>
</div>



<div data-role="page" id="edit">
  <header data-role="header" data-theme="b">
  <h1>iGeneral Book</h1>
  </header>
  <div data-role="navbar">
    <ul>
      <li><a href="#home" data-transition="none" data-icon="home"></a></li>
      <li><a href="#add" data-transition="none" data-icon="plus"></a></li>
    </ul>
  </div>
  <div data-role="content">
    <h3>Edit Contact</h3>
    <form id="editForm" class="signupForm" action="index_submit" method="get" accept-charset="utf-8">
      <label for="editName"></label>
      <input type="text" class="form-field" id="editName"/> 

      <label for="editPhone"></label>
      <input type="text" data-role="phone" class="form-field" id="editPhone" data-inline="true"/>


       <label for="editUrl"></label>
      <input type="text" class="form-field" id="editUrl"/> 

      <label for="editInfo"></label>
      <input type="text" data-role="info" class="form-field" id="editInfo" data-inline="true"/>

      <button id="submitEdit" class="ui-btn ui-btn-b ui-corder-all">Submit</button>
    </form>
    </div>
	<footer data-role="footer" data-theme="b">
  <h4>iGeneral Book &copy; 2017</h4>
</footer>
</div>

</div>

<script>
$(document).one('pageinit', function(){


    //showContacts();
  showContacts();

    //add handler
    $('#submitAdd').on('tap', addContact);
    //edit handleer
    $('#submitEdit').on('tap', editContact);
    //delete contact
    $('#search').on('tap', '#deleteLink', deleteContact);
    //setcurrent
    $('#search').on('tap', '#editLink', function(event) {
      //event.preventDefault();
      // Store data in localstorage 
      localStorage.setItem('currentName', $(this).data('name'));
      localStorage.setItem('currentPhone', $(this).data('phone'));
      localStorage.setItem('currentUrl', $(this).data('url'));
      localStorage.setItem('currentInfo', $(this).data('info'));
      
      //set form value
      $('#editName').val(localStorage.getItem('currentName'));
      $('#editPhone').val(localStorage.getItem('currentPhone'));
      $('#editUrl').val(localStorage.getItem('currentUrl'));
      $('#editInfo').val(localStorage.getItem('currentInfo'));
    });
    //setcurrent
    $('#clearContacts').on('tap', function(event) {
      //event.preventDefault();
      localStorage.removeItem('contacts');
      $('#search').html('<p>You have not logged contact</p>');
      //redirect
      //window.location.href =  'index.html';
      return false;
    });
  
  // show contacts
  
  function showContacts(){
    let contacts = getontactsObject();
    if(contacts != '' && contacts != null){
      for (let i = 0; i < contacts.length; i++) {
        $('#search').append('<li class="ui-body-inherit ui-li-static"><strong>Name:</strong>'+
          contacts[i]["name"]+
            '<br/><strong>Phone:</strong>'+contacts[i]["phone"] +
            '<br/><strong>Url:</strong>'+contacts[i]["url"] +
            '<br/><strong>Info:</strong>'+contacts[i]["info"] +
            'm<div class="controls">'+
              '<a target="_blank" href="data-info="'+ contacts[i]["url"]+'"">Visit</a> | <a href="#edit" id="editLink" data-name="'+ contacts[i]["name"]+'" data-phone="'+ contacts[i]["phone"]+'" data-url="'+ contacts[i]["url"]+'" data-info="'+ contacts[i]["info"]+'">Edit</a> | <a href="#" id="deleteLink" data-name="'+ contacts[i]["name"]+'" data-phone="'+ contacts[i]["phone"]+'" data-url="'+ contacts[i]["url"]+'" data-info="'+ contacts[i]["info"]+'" onClick="return confirm(\' Are you sure?\')">Delete</a>'
            +'</div></li>')
      };
    $('#home').bind('pageInit', function(event) {
      $('search').listView('refresh');
    });
    }
    else{
        $('#search').html('<p>You have no logged contact</p>');
    }
  }
  //mask
 // $(function () {
 // $('#addPhone').one('focus', function () {
  //  $(this).val("+380-")
 // });
//});
   //$(function () {
  //$('#editPhone').one('focus', function () {
   // $(this).val("+380-")
  //});
//});
	//mask
  $(":input").inputmask();

$("#addphone").inputmask({"mask": "(999) 999-9999"});
$("#editphone").inputmask({"mask": "(999) 999-9999"});
 function validateSignup()
{   
    $.validator.addMethod(
            "regex",
            function(value, element, regexp) 
            {
                if (regexp.constructor != RegExp)
                    regexp = new RegExp(regexp);
                else if (regexp.global)
                    regexp.lastIndex = 0;
                return this.optional(element) || regexp.test(value);
            },
            "Please check your input."
    );

    $('.signupForm').validate(//????????????????????????????# to html either
    {

        onkeyup : false,
        errorClass: "req_mess",
        ignore: ":hidden",
        validClass: "signup_valid_class",
        errorClass: "signup_error_class",

        rules:
        {

            name:
            {
                required: true,
                name: true,
                regex: /^[a-zA-Z]+$/,
            },

           

            phone:
            {
                required: true,
                regex: /^[+-]{1}[0-9]{1,3}\-[0-9]{10}$/,
            },
            url:
            {
                required: true,
                url: true,
                regex: /[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi,
            },
            info:
            {
                required: true,
                info: true,
                regex: /^[a-zA-Z]+$/,
            },


        },
        messages: 
        {
            name: 
            {
                required: 'You must enter a name',
                regex: 'Please enter a valid name without spacial chars, ie, Name'
            },

       

            phone: 
            {
                required: "Please enter your phone number",
                regex: "e.g. +91-1234567890"    
            },
            url: 
            {
                required: 'You must enter a url',
                regex: 'Please enter a valid url without spacial chars, ie, http://'
            },
            info: 
            {
                required: 'You must enter a info',
                regex: 'Please enter a valid info without spacial chars, ie, Chars'
            },

        },

        submitHandler: function (form)
        {
            return true;
        }
    });
}
  // Add a contact
  
    function addContact(){
    //get the values
    let name = $('#addName').val();
    let phone = $('#addPhone').val();
    let url = $('#addUrl').val();
    let info = $('#addInfo').val();
    //create contact boject
    let contact = {
        
        name:name,
        phone:phone,
        url:url,
        info:info
    }
    //get current contact
    let contacts = getContactsObject();
    //add contact to contacts array
    contacts.push(contact);
    alert('Contact added');
    //stringify
    localStorage.setItem('contacts', JSON.stringify(contacts));
    //redirect
    window.location.href =  'index.html';
    return false;
  }
  
  // edit a contact
  
    function editContact(){
      //get current values
      currentName = localStorage.getItem('currentName');
      currentPhone = localStorage.getItem('currentPhone');
      currentUrl = localStorage.getItem('currentUrl');
      currentInfo = localStorage.getItem('currentInfo');
      
      //get current contact
    let contacts = getContactsObject();
    for (let i = 0; i < contacts.length; i++) {
      if((contacts[i]['phone'] == currentPhone && contacts[i]['name'] == currentName) && (contacts[i]['info'] == currentInfo && contacts[i]['url'] == currentUrl)){
        contacts.splice(i, 1);
      }
      localStorage.setItem('contacts', JSON.stringify(contacts));
    };
    //get the values
    
    let name = $('#editName').val();
    let phone = $('#editPhone').val();
    let url = $('#editdUrl').val();
    let info = $('#editInfo').val();
    //create contact boject
    let contact_update = {
        
        name:name,
        phone:phone,
        url:url,
        info:info
    }
    //add contact to contacts array
    contacts.push(contact_update);
    alert('Contact updated');
    //stringify
    localStorage.setItem('contacts', JSON.stringify(contacts));
    //redirect
    window.location.href =  'index.html';
    return false;
  }
  
  // delete a contact
  
    function deleteContact(){
      // Store data in localstorage 
      localStorage.setItem('currentPhone', $(this).data('phone'));
      localStorage.setItem('currentName', $(this).data('name'));
      localStorage.setItem('currentUrl', $(this).data('url'));
      localStorage.setItem('currentInfo', $(this).data('info'));
      //get current values
      currentPhone = localStorage.getItem('currentPhone');
      currentName = localStorage.getItem('currentName');
      currentUrl = localStorage.getItem('currentUrl');
      currentInfo = localStorage.getItem('currentInfo');
      //get current contact
    let contacts = getContactsObject();
    for (let i = 0; i < contacts.length; i++) {
      if((contacts[i]['phone'] == currentPhone && contacts[i]['name'] == currentName) && (contacts[i]['info'] == currentInfo && contacts[i]['url'] == currentUrl)){
        contacts.splice(i, 1);
      }
      localStorage.setItem('contacts', JSON.stringify(contacts));
    };
    alert('Contact deleted');
    //redirect
    window.location.href =  'index.html';
    return false;
  }
    //
    function getContactsObject(){
      //set contacts array
      let contacts = new Array();
      //get current array from localstorage
      let currentContacts = localStorage.getItem('contacts');
      if(currentContacts != null ){
          let  contacts = JSON.parse(currentContacts);
          
      }
      //return contacts object
      return contacts.sort(function(a,b){return new Name(b.name) - new Name(b.name)});
       }
});


</script>


<style>/*//---------------------------------------------------------------------jQuery*/
/*
body{
text-align: center;
}
ul{
  display: block;
}
.controls{
  float:right;
}
#stats p{
  color:red;
  padding: 10px;
}*/
body{
text-align: center;
}
ul{
	display: block;
}
.controls{
	float:right;
}
#search p{
	color:red;
	padding: 10px;
}
input {
  font-family: monospace;
}
label {
  display: block;
}
div {
  margin: 0 0 1rem 0;
}
</style>
</body>
</html>
